{% load static %}

{% block content %}

    <!-- Main Content -->
    <div class="content flex-1">
      <h2 class="text-2xl font-bold mb-6 text text-red-600">ðŸ”¥ Fire & Accident Detection (Anomaly Page)</h2>

      <form action="{% url 'upload_fire_video' %}" method="post" enctype="multipart/form-data" class="mb-6">
        {% csrf_token %}
        <input type="file" name="video" accept="video/*" required class="block mb-4 p-2 border rounded">
        <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Upload & Detect</button>
      </form>

      {% if error %}
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6" role="alert">
          <p>{{ error }}</p>
        </div>
      {% endif %}

      <!-- Video Display Section: Original Video (Left) and Detected Output (Right) -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        {% if input_video_url %}
          <div>
            <h3 class="font-semibold text-center text-blue-600 mb-2">Player Projection Video</h3>
            <video width="100%" controls id="originalVideo">
              <source src="{{ input_video_url }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>
        {% endif %}

        {% if output_video_url %}
          <div>
            <h3 class="font-semibold text-center text-blue-600 mb-2">Tracking Video</h3>
            <video width="100%" controls id="predictedVideo">
              <source src="{{ output_video_url }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>
        {% endif %}
      </div>

      <!-- Add synchronization controls -->
      {% if input_video_url and output_video_url %}
      <div class="mt-6 text-center">
        <button id="syncPlayButton" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 mr-2">
          Play Both Videos
        </button>
        <button id="syncPauseButton" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
          Pause Both Videos
        </button>
      </div>

      <script>
        document.addEventListener('DOMContentLoaded', function() {
          const originalVideo = document.getElementById('originalVideo');
          const predictedVideo = document.getElementById('predictedVideo');
          const syncPlayButton = document.getElementById('syncPlayButton');
          const syncPauseButton = document.getElementById('syncPauseButton');
          
          // Synchronize videos when one video is played/paused
          originalVideo.addEventListener('play', function() {
            predictedVideo.currentTime = originalVideo.currentTime;
            predictedVideo.play();
          });
          
          originalVideo.addEventListener('pause', function() {
            predictedVideo.pause();
          });
          
          predictedVideo.addEventListener('play', function() {
            originalVideo.currentTime = predictedVideo.currentTime;
            originalVideo.play();
          });
          
          predictedVideo.addEventListener('pause', function() {
            originalVideo.pause();
          });
          
          // Sync button controls
          syncPlayButton.addEventListener('click', function() {
            originalVideo.play();
            predictedVideo.play();
          });
          
          syncPauseButton.addEventListener('click', function() {
            originalVideo.pause();
            predictedVideo.pause();
          });
          
          // Keep videos in sync during playback
          originalVideo.addEventListener('timeupdate', function() {
            // Only sync if the time difference is more than 0.5 seconds
            if (Math.abs(originalVideo.currentTime - predictedVideo.currentTime) > 0.5) {
              predictedVideo.currentTime = originalVideo.currentTime;
            }
          });
        });
      </script>
      {% endif %}
    </div>
  </div>

{% endblock %}
